using AutoMapper;using MediatR;using Merchants.Application.Commands.ComplaintType;using Merchants.Application.Commands.Escalation;using Merchants.Application.Exceptions;using Merchants.Application.Responses;using Merchants.Core.Interfaces;using Microsoft.AspNetCore.Http;using Microsoft.Extensions.Logging;using System;using System.Collections.Generic;using System.Linq;using System.Text;using System.Threading.Tasks;namespace Merchants.Application.Handlers.Escalation{    //internal class UpdateEscalationCommandHandler    //{    //}    public class UpdateEscalationCommandHandler : IRequestHandler<UpdateEscalationCommand, Response>    {        private readonly ILogger _logger;        private readonly IHttpContextAccessor _httpContextAccessor;        private readonly IMapper _mapper;        private readonly IEscalation _EscalationRepository;        //private readonly Mail _mail;        //private readonly IConfiguration _configuration;        //private readonly string _baseUrl;        //private readonly IRedisCacheService _redisCacheService;        public UpdateEscalationCommandHandler(IEscalation eslcalation, IMapper mapper,            ILogger<UpdateEscalationCommandHandler> logger, IHttpContextAccessor httpContextAccessor)        {            _EscalationRepository = eslcalation;            _mapper = mapper;            _logger = logger;            _httpContextAccessor = httpContextAccessor;            //_mail = mail;            //_configuration = configuration;            ////_baseUrl = _configuration["Urls:ActivationUrl"];            //_redisCacheService = redisCacheService;        }        public async Task<Response> Handle(UpdateEscalationCommand request, CancellationToken cancellationToken)        {            Response response = new Response();            try            {                var EscalationToUpdate = await _EscalationRepository.GetEscalationByID(request.MatrixID);                if (EscalationToUpdate == null)                {                    _logger.LogError($"Escalation Not found for updation.");                    throw new MerchantNotFoundException(nameof(EscalationToUpdate), request.MatrixID);                }                var escalationEntity = _mapper.Map<Merchants.Core.Entities.Escalation>(request);                escalationEntity.ID = request.MatrixID;                 escalationEntity.Status = EscalationToUpdate.Status;                escalationEntity.UpdatedBy = Guid.Parse(_httpContextAccessor.HttpContext?.User?.FindFirst("UserID")?.Value); ;                var generatedMerchant = await _EscalationRepository.UpdateAsync(escalationEntity);                response.isSuccess = true;                response.ResponseCode = 1;                response.ResponseDescription = "Escalation Category updated Successfully.";                response.Data = generatedMerchant;                _logger.LogInformation($"Escalation {escalationEntity} updated successfully.");                return response;            }            catch (Exception ex)            {                _logger.LogError($"Escalation addition failed {ex.Message}.");                response.isSuccess = false;                response.ResponseCode = 0;                response.ResponseDescription = ex.Message;                response.Data = null;                return response;            }        }    }}